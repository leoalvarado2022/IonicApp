<ion-header>
  <ion-toolbar class="background-color-header">
    <ion-buttons slot="start">
      <ion-back-button class="header-back-button" text=""></ion-back-button>
    </ion-buttons>
    <ion-title>
      <strong>Crear Detalle</strong>
    </ion-title>
    <ion-buttons slot="end">
      <app-notifications></app-notifications>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-tabs class="ticket-detail-tabs">
    <!-- Tab bar -->
    <ion-tab-bar slot="top">
      <ion-tab-button (click)="activeTab = 1" [selected]="activeTab === 1">
        <span>Detalle</span>
      </ion-tab-button>
      <ion-tab-button (click)="activeTab = 2" [selected]="activeTab === 2">
        <span>Adjuntos</span>
      </ion-tab-button>
    </ion-tab-bar>
  </ion-tabs>

  <div class="detail-content-tab">
    <form [formGroup]="ticketForm">
      <ng-container *ngIf="activeTab === 1">

        <ion-item>
          <ion-label position="stacked">Observaciones</ion-label>
          <ion-textarea rows="5" formControlName="observations"></ion-textarea>
        </ion-item>

        <ion-item>
          <ion-label>Estado</ion-label>
          <ion-select placeholder="Estado" formControlName="state">
            <ion-select-option *ngFor="let state of states" [value]="state.name">{{ state.name | titlecase }}</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label>Asignado</ion-label>
          <ion-select placeholder="Asignado" formControlName="assigned_id">
            <ion-select-option *ngFor="let user of users" [value]="user.id">{{ user.name | titlecase }}</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label>Prioridad</ion-label>
          <ion-select placeholder="Prioridad" formControlName="priority">
            <ion-select-option *ngFor="let priority of priorities" [value]="priority.name">{{ priority.name | titlecase }}</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label>Dificultad</ion-label>
          <ion-select placeholder="Dificultad" formControlName="difficulty">
            <ion-select-option *ngFor="let difficulty of difficulties" [value]="difficulty.level">{{ difficulty.name | titlecase }}</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label>Compromiso Interno</ion-label>
          <ion-datetime formControlName="commitmentAt" [displayFormat]="dateFormat" [max]="maxDate" [pickerFormat]="dateFormat"></ion-datetime>
        </ion-item>

        <ion-item>
          <ion-label>Compromiso Cliente</ion-label>
          <ion-datetime formControlName="commitmentInternAt" [displayFormat]="dateFormat" [max]="maxDate" [pickerFormat]="dateFormat"></ion-datetime>
        </ion-item>

        <ion-item>
          <ion-label>Publico</ion-label>
          <ion-select placeholder="Publico" formControlName="public">
            <ion-select-option [value]="true">Si</ion-select-option>
            <ion-select-option [value]="false">No</ion-select-option>
          </ion-select>
        </ion-item>

      </ng-container>

      <ng-container *ngIf="activeTab === 2">
        <!-- [disabled]="ticketForm.invalid" -->
        <ion-button expand="block" color="warning" (click)="pickFiles()">
          Agregar Archivos
        </ion-button>

        <!-- List of Sliding Items -->
        <ion-list *ngIf="attachments.length > 0">
          <ion-item-sliding *ngFor="let item of attachments">
            <ion-item>
              <ion-label>{{ item.name }}</ion-label>
            </ion-item>
            <ion-item-options side="end">
              <ion-item-option color="danger" (click)="deleteFile(item)">Borrar</ion-item-option>
            </ion-item-options>
          </ion-item-sliding>
        </ion-list>
      </ng-container>

      <ion-button expand="block" (click)="submitDetail()" [disabled]="ticketForm.invalid">
        Crear Detalle
      </ion-button>
    </form>
  </div>

</ion-content>
