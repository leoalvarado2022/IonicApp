<ion-header>
  <ion-toolbar class="background-color-header">
    <ion-buttons slot="start">
      <ion-back-button class="header-back-button" text=""></ion-back-button>
    </ion-buttons>
    <ion-title>
      <strong>Crear Detalle</strong>
    </ion-title>
    <ion-buttons slot="end">
      <app-notifications></app-notifications>
    </ion-buttons>
  </ion-toolbar>

  <ion-toolbar>
    <ion-tabs>
      <!-- Tab bar -->
      <ion-tab-bar slot="top">
        <ion-tab-button (click)="activeTab = 1" [selected]="activeTab === 1">
          <span>Detalle</span>
        </ion-tab-button>
        <ion-tab-button (click)="activeTab = 2" [selected]="activeTab === 2">
          <span>Adjuntos</span>
        </ion-tab-button>
      </ion-tab-bar>
    </ion-tabs>
  </ion-toolbar>
</ion-header>

<ion-content>
    <form [formGroup]="ticketForm">

      <!-- FORM DATA-->
      <ng-container *ngIf="activeTab === 1">
        <ion-item>
          <ion-label position="stacked">Observaciones</ion-label>
          <ion-textarea rows="5" formControlName="observations"></ion-textarea>
        </ion-item>

        <ion-item>
          <ion-label>Estado</ion-label>
          <ion-select formControlName="state" placeholder="Estado" cancelText="Cancelar" interface="action-sheet" [interfaceOptions]="actionHeader">
            <ion-select-option *ngFor="let state of states | alphabeticalOrder" [value]="state.name">{{ state.name | titlecase }}</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label>Asignado</ion-label>
          <ion-select formControlName="assigned_id" placeholder="Asignado" cancelText="Cancelar" interface="action-sheet" [interfaceOptions]="actionHeader">
            <ion-select-option *ngFor="let user of users | alphabeticalOrder" [value]="user.id">{{ user.name | titlecase }}</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label>Prioridad</ion-label>
          <ion-select formControlName="priority" placeholder="Prioridad" cancelText="Cancelar" interface="action-sheet" [interfaceOptions]="actionHeader">
            <ion-select-option *ngFor="let priority of priorities | alphabeticalOrder" [value]="priority.name">{{ priority.name | titlecase }}</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label>Dificultad</ion-label>
          <ion-select formControlName="difficulty" placeholder="Dificultad" cancelText="Cancelar" interface="action-sheet" [interfaceOptions]="actionHeader">
            <ion-select-option *ngFor="let difficulty of difficulties | alphabeticalOrder" [value]="difficulty.level">{{ difficulty.name | titlecase }}</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label>Compromiso Interno</ion-label>
          <ion-datetime formControlName="commitmentAt" [displayFormat]="dateFormat" [max]="maxDate" [pickerFormat]="dateFormat"></ion-datetime>
        </ion-item>

        <ion-item>
          <ion-label>Compromiso Cliente</ion-label>
          <ion-datetime formControlName="commitmentInternAt" [displayFormat]="dateFormat" [max]="maxDate" [pickerFormat]="dateFormat"></ion-datetime>
        </ion-item>

        <ion-item>
          <ion-label>Publico</ion-label>
          <ion-select formControlName="public" placeholder="Publico" cancelText="Cancelar" interface="action-sheet" [interfaceOptions]="actionHeader">
            <ion-select-option [value]="true">Si</ion-select-option>
            <ion-select-option [value]="false">No</ion-select-option>
          </ion-select>
        </ion-item>

      </ng-container>

      <!-- FORM ATTACHMENTS -->
      <ng-container *ngIf="activeTab === 2">

        <ion-item>
          <ion-button (click)="openCamera()" slot="start">
            <ion-icon name="camera" slot="icon-only"></ion-icon>
          </ion-button>
          <ion-label>Agregar Archivos</ion-label>
          <ion-button (click)="openGallery()" slot="end">
            <ion-icon name="image" slot="icon-only"></ion-icon>
          </ion-button>
        </ion-item>

        <!-- List of Sliding Items -->
        <ion-list *ngIf="attachments.length > 0">
          <ion-item-sliding *ngFor="let item of attachments">
            <ion-item>
              <ion-label>{{ item.name }}</ion-label>
            </ion-item>
            <ion-item-options side="end">
              <ion-item-option color="danger" (click)="deleteFile(item)">Borrar</ion-item-option>
            </ion-item-options>
          </ion-item-sliding>
        </ion-list>
      </ng-container>
    </form>
</ion-content>

<ion-footer>
  <ion-button expand="block" (click)="submitDetail()" [disabled]="ticketForm.invalid">
    Crear Detalle
  </ion-button>
</ion-footer>
