<ion-header>
  <ion-toolbar class="background-color-header">
    <ion-buttons slot="start">
      <ion-back-button class="header-back-button" text=""></ion-back-button>
    </ion-buttons>
    <ion-title>
      <strong>Consumos</strong>
    </ion-title>
    <ion-buttons slot="end">
      <app-toolbar-buttons></app-toolbar-buttons>
    </ion-buttons>
  </ion-toolbar>  
</ion-header>

<ion-content>
  <ion-card>
    <ion-item lines="full">
      <ion-label>Bluetooth</ion-label>
      <ion-icon slot="end" name="bluetooth-outline" [color]="isBluetoothEnabled ? 'success' : 'danger'"></ion-icon>
    </ion-item>  
  </ion-card>
  
  <ng-container *ngIf="isBluetoothEnabled">

    <ion-card>
      <ion-card-header>        
        <ion-card-subtitle>Dispositivos Emparejados</ion-card-subtitle>
      </ion-card-header>

      <ion-card-content>
        <ng-container *ngIf="(getPairedDevices() | async)">      
          <ion-list lines="full">
            <ng-container *ngFor="let device of getPairedDevices() | async">
              <ng-container *ngIf="isDeviceConnected">
                <ion-item (click)="disconnectDevice(device)" button>
                  <ion-label>{{ device.name ? device.name : device.address }}</ion-label>
                  <ion-icon slot="end" name="bluetooth-outline" color="success" ></ion-icon>
                </ion-item>  
              </ng-container>
              <ng-container *ngIf="!isDeviceConnected">
                <ion-item (click)="connectDevice(device)" button>
                  <ion-label>{{ device.name ? device.name : device.address }}</ion-label>
                  <ion-icon slot="end" name="bluetooth-outline" color="danger"></ion-icon>
                </ion-item>  
              </ng-container>              
            </ng-container>            
          </ion-list>

          <ng-container *ngIf="lastWeight">
            Ultimo Peso: {{ lastWeight }} KG
          </ng-container>

          <ion-button *ngIf="isDeviceConnected" expand="full" (click)="readData()">
            <ion-icon slot="start" name="barbell-outline"></ion-icon>
            Obtener datos
          </ion-button>
        </ng-container>
      </ion-card-content>      
    </ion-card>

    <ion-card>
      <ion-card-header>        
        <ion-card-subtitle>Dispositivos Disponibles</ion-card-subtitle>
      </ion-card-header>

      <ion-card-content>
        <ng-container *ngIf="(getAvailableDevices() | async); else noDevicesAvailable">      
          <ion-list lines="full">
            <ion-item *ngFor="let device of getAvailableDevices() | async" (click)="connectDevice(device)" button>
              <ion-label>{{ device.name ? device.name : device.address }}</ion-label>
              <ion-icon slot="end" name="bluetooth-outline"></ion-icon>
            </ion-item>  
          </ion-list>      
        </ng-container>

        <ng-template #noDevicesAvailable>
          No se encuentran Dispositivos
        </ng-template>

        <ng-container *ngIf="isSearching">
          Buscando Dispositivos
        </ng-container>

        <ion-button expand="full" (click)="scanDevices()">
          <ion-icon slot="start" name="search"></ion-icon>
          Buscar Dispositivos
        </ion-button>
      </ion-card-content>      
    </ion-card>
    

  </ng-container>
  
  
</ion-content>